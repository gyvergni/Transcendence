# Stage 1: Build the frontend
FROM node:20-alpine AS builder
WORKDIR /app
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install
COPY . .

ARG IP
ENV IP=${IP}

RUN pnpm build

# Stage 2: Copy build artifacts into shared volume
FROM alpine:latest
VOLUME ["/usr/share/frontend"]
COPY --from=builder /app/dist /tmp/dist

CMD ["sh", "-c", "cp -r /tmp/dist/* /usr/share/frontend/ && echo 'Frontend build copied to shared volume'"]
